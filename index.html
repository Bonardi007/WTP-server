<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>PokeGuess Client</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #log { border: 1px solid #ccc; height: 200px; overflow-y: auto; padding: 5px; }
  </style>
</head>
<body>

  <h2>PokeGuess â€“ Client Base</h2>

  <div>
    <label>Nickname: </label>
    <input id="nickname" type="text" />
    <button onclick="joinGame()">Join</button>
  </div>

  <br>

  <div>
    <label>Risposta PokÃ©mon: </label>
    <input id="guess" type="text" />
    <button onclick="sendGuess()">Invia</button>
  </div>

  <br>

  <button onclick="requestNumber()">ğŸ‘‰ Richiedi Numero PokÃ©mon</button>
  <button onclick="requestName()">ğŸ‘‰ Richiedi Nome PokÃ©mon</button>

  <h3>Log:</h3>
  <div id="log"></div>

  <script>
    const logBox = document.getElementById('log');

    function log(msg) {
      logBox.innerHTML += msg + "<br>";
      logBox.scrollTop = logBox.scrollHeight;
    }

    const socket = new WebSocket("ws://localhost:3000");

    socket.onopen = () => log("ğŸ”— Connesso al server");

    socket.onmessage = evt => {
      const msg = JSON.parse(evt.data);

      if (msg.type === 'init') {
        log("ğŸ†— Inizializzato! ID: " + msg.id);
      }

      if (msg.type === 'invio_numero') {
        log("ğŸ“Ÿ Numero PokÃ©mon ricevuto: " + msg.pokemon.numero);
      }

      if (msg.type === 'invio_nome') {
        log("ğŸ”¤ Nome PokÃ©mon ricevuto: " + msg.pokemon.nome);
      }

      if (msg.type === 'Correct') {
        log("âœ… Risposta corretta di: " + msg.msg.Risposta);
      }

      if (msg.type === 'Wrong') {
        log("âŒ Risposta sbagliata di: " + msg.msg.Risposta);
      }

      if (msg.type === 'remove') {
        log("ğŸšª Giocatore disconnesso: " + msg.id);
      }
    };

    // ====== FUNZIONI CLIENT ======

    function joinGame() {
      const nickname = document.getElementById('nickname').value;
      if (!nickname) return;
      socket.send(JSON.stringify({ type: 'Join', nickname }));
      log("ğŸ‘¤ Join inviato: " + nickname);
    }

    function sendGuess() {
      const Risposta = document.getElementById('guess').value;
      if (!Risposta) return;
      socket.send(JSON.stringify({ type: 'Guess', Risposta }));
      log("ğŸ¯ Guess inviato: " + Risposta);
    }

    // Queste due dipendono da funzioni lato server
    function requestNumber() {
      socket.send(JSON.stringify({ type: 'RequestNumero' }));
      log("ğŸ”¢ Richiesto numero PokÃ©mon");
    }

    function requestName() {
      socket.send(JSON.stringify({ type: 'RequestNome' }));
      log("ğŸ“› Richiesto nome PokÃ©mon");
    }
  </script>
</body>
</html>
